<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Stay Safe</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
    crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="assets/style.css">
  <style>
    #map {
      height: 100%;
    }

    /* Makes the map page fill the window. */

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>

  <!-- /* NavBar */ -->

  <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
    <a class="navbar-brand" href="#">
      <img src="assets/images/logo_safe.png" width="30" height="30" class="d-inline-block align-top" alt=""> StaySafe
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
        </li>
        <li class="nav-item">

        </li>
        <li class="nav-item dropdown">

          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </li>
        <li class="nav-item">

        </li>
      </ul>
    </div>
  </nav>




  <div id="map"></div>

  <!--TWITTER API AUTH

consumer_key="rGLXVdjmyyO59g1yvZskv39Ad"
consumer_secret="yZlMRubuuVSi2RPP5T67svJsbHNPJ9kJLrb0NA3IM5jDkY2TCy"
access_token="979050268124852225-kzJPEmC5ysS6X37a5n455t1bLGXuGAY"
access_token_secret="NGyFZY58WcFxlJzewGIKv22r3AX0tQwcPT1Qxk1FDbB3g"

auth = tweepy.OAuthHandler(consumer_key, consumer_secret)
auth.set_access_token(access_token, access_token_secret)
-->

  <div class="detailsCard">
    <div class="twitterCard">
      <a class="twitter-timeline" data-width="215" data-height="350" data-theme="dark" data-link-color="#2B7BB9" href="https://twitter.com/StaySafeTec?ref_src=twsrc%5Etfw">Tweets by StaySafeTec</a>
      <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>

    <div class="detailsCard2 text-center text-white bg-dark mb-3">
      <div class="card-body">
        <h5 class="card-title">Danger Level: 1 - 10</h5>

        <div class="nombres text-center">
          <div id="juncoDeLaVega">Junco de la vega</div>
          <div id="mapJuncoDeLaVega">Actual danger level: </div>
          <form class="poll" id="pollJuncoDeLaVega" name="juncoDeLaVega">
            <input type="text" name="vJuncoDeLaVega" id="vJuncoDeLaVega" value="Rate from 1 to 10">
            <input class="btn" id="bJuncoDeLaVega" type="button" value="SUBMIT">
          </form>
        </div>
      </div>

      <div class="nombres text-center">
        <div id="luisElizondo">Luis Elizondo</div>
        <div id="pLuisElizondo">Actual danger level: </div>
        <form class="poll" id="pollLuisElizondo" name="luisElizondo">
          <input type="text" name="vLuisElizondo" id="vLuisElizondo" value="Rate from 1 to 10">
          <input class="btn" id="bLuisElizondo" type="button" value="SUBMIT">

        </form>
      </div>
      <br>



      <div class="nombres text-center">
        <div id="garciaRoel">Garcia Roel</div>
        <div id="pGarciaRoel">Actual danger level: </div>

      </div>
      <form class="poll" id="pollGarciaRoel" name="garciaRoel">
        <input type="text" name="vGarciaRoel" id="vGarciaRoel" value="Rate from 1 to 10">
        <input class="btn" id="bGarciaRoel" type="button" value="SUBMIT">

      </form>
    <br>


    <div class="nombres text-center">
      <div id="avenidaDelEstado">Avenida Del Estado</div>
      <div id="pAvenidaDelEstado">Actual danger level: </div>

    </div>
    <form class="poll" id="pollAvenidaDelEstado" name="avenidaDelEstado">
      <input type="text" name="vAvenidaDelEstado" id="vAvenidaDelEstado" value="Rate from 1 to 10">
      <input class="btn" id="bAvenidaDelEstado" type="button" value="SUBMIT">

    </form>
  </div>
</div>





  <a href="#" class="btn btn-primary">Grade</a>
  </div>


  </div>


  </div>
  </div>

  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="test.js"></script>

  </div>




  <div class="ButtonPanel ButtonPanel-expand-lg fixed-bottom ButtonPanel-dark bg-dark">
    <a class="ButtonPanel-brand" href="#">
      <img src="https://media.scmagazineuk.com/images/2014/07/09/twitter_626161.png" id="picTwitter" width="80" height="80" class="d-inline-block align-top"
        alt="">
      <p id="textTwitter">Twitter Feed</p>
    </a>
    <a class="ButtonPanel-brand" href="#">
      <img src="https://i.pinimg.com/originals/c2/5c/73/c25c737ff2ec8a00db52edb49c1eccd0.png" id="picDanger" width="80" height="80"
        class="d-inline-block align-top" alt="">
      <p id="textTwitter">Danger Levels</p>
    </a>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
    crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
  <script src="firebase/test.js" type="text/javascript"></script>
  <script src="app.js" type="text/javascript"></script>
  <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
  <script>
    /**
    * Reference to Firebase database.
    */
    var firebase = new Firebase('https://fire-map-tutorial.firebaseio.com/');

    /**
    * Data object to be written to Firebase.
    */
    var data = {
      sender: null,
      timestamp: null,
      lat: null,
      lng: null
    };

    function makeInfoBox(controlDiv, map) {
      // Set CSS for the control border.
      var controlUI = document.createElement('div');
      controlUI.style.boxShadow = 'rgba(0, 0, 0, 0.298039) 0px 1px 4px -1px';
      controlUI.style.backgroundColor = '#fff';
      controlUI.style.border = '2px solid #fff';
      controlUI.style.borderRadius = '2px';
      controlUI.style.marginBottom = '22px';
      controlUI.style.marginTop = '10px';
      controlUI.style.textAlign = 'center';
      controlDiv.appendChild(controlUI);

      // Set CSS for the control interior.
      var controlText = document.createElement('div');
      controlText.style.color = 'rgb(25,25,25)';
      controlText.style.fontFamily = 'Roboto,Arial,sans-serif';
      controlText.style.fontSize = '100%';
      controlText.style.padding = '6px';
      controlUI.appendChild(controlText);
    }

    /**
    * Starting point for running the program. Authenticates the user.
    */
    function initAuthentication(onAuthSuccess) {
      firebase.authAnonymously(function (error, authData) {
        if (error) {
          console.log('Login Failed!', error);
        } else {
          data.sender = authData.uid;
          onAuthSuccess();
        }
      }, { remember: 'sessionOnly' });  // Users will get a new id for every session.
    }

    /**
     * Creates a map object with a click listener and a heatmap.
     */
    function initMap() {
      var map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 25.650983, lng: -100.289723 },
        zoom: 17,
        mapTypeId: 'satellite',
        styles: [{
          featureType: 'poi',
          stylers: [{ visibility: 'off' }]  // Turn off POI.
        },
        {
          featureType: 'transit.station',
          stylers: [{ visibility: 'off' }]  // Turn off bus, train stations etc.
        }],
        disableDoubleClickZoom: true,
        streetViewControl: false,
      });
      /**
      //This centers the map on the user's device location
      if (navigator.geolocation) {
   navigator.geolocation.getCurrentPosition(function (position) {
       initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
       map.setCenter(initialLocation);
   });
}*/

      // Create the DIV to hold the control and call the makeInfoBox() constructor
      // passing in this DIV.
      var infoBoxDiv = document.createElement('div');
      makeInfoBox(infoBoxDiv, map);
      map.controls[google.maps.ControlPosition.TOP_CENTER].push(infoBoxDiv);

      // Listen for clicks and add the location of the click to firebase.
      map.addListener('click', function (e) {
        data.lat = e.latLng.lat();
        data.lng = e.latLng.lng();
        addToFirebase(data);
      });

      // Create a heatmap.
      var heatmap = new google.maps.visualization.HeatmapLayer({
        data: [],
        map: map,
        radius: 40,
        intensity: 50
      });

      initAuthentication(initFirebase.bind(undefined, heatmap));
    }


    function initFirebase(heatmap) {

      // Changed time so the heatpoints wont vanish
      var startTime = new Date().getTime() - (60 * 1000000 * 1000);

      // Reference to the clicks in Firebase.
      var clicks = firebase.child('clicks');

      // Listener for when a click is added.
      clicks.orderByChild('timestamp').startAt(startTime).on('child_added',
        function (snapshot) {

          // Get that click from firebase.
          var newPosition = snapshot.val();
          var point = new google.maps.LatLng(newPosition.lat, newPosition.lng);
          var elapsed = new Date().getTime() - newPosition.timestamp;

          // Add the point to  the heatmap.
          heatmap.getData().push(point);
        }
      );


    }

    function getTimestamp(addClick) {
      // Reference to location for saving the last click time.
      var ref = firebase.child('last_message/' + data.sender);

      ref.onDisconnect().remove();  // Delete reference from firebase on disconnect.

      // Set value to timestamp.
      ref.set(Firebase.ServerValue.TIMESTAMP, function (err) {
        if (err) {  // Write to last message was unsuccessful.
          console.log(err);
        } else {  // Write to last message was successful.
          ref.once('value', function (snap) {
            addClick(snap.val());  // Add click with same timestamp.
          }, function (err) {
            console.warn(err);
          });
        }
      });
    }

    //Adds click to firebase
    function addToFirebase(data) {
      getTimestamp(function (timestamp) {
        // Add the new timestamp to the record data.
        data.timestamp = timestamp;
        var ref = firebase.child('clicks').push(data, function (err) {
          if (err) {  // Data was not written to firebase.
            console.warn(err);
          }
        });
      });
    }


  </script>
  <script src="test.js"></script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIrboov54xOjrltjhHee4RENcHgKDAqEA&libraries=visualization&callback=initMap">
  </script>
</body>

</html>